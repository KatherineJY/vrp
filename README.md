
# VRPPDTW
### Problem Discription
* #### 工厂物流调度需求
    * 有多条流水线，每条流水线有两两个端点。流水线的起点需要原材料或其他流水线的产物。流水线的终点会产出中间产物或最终产物。流水线起点所需的产物需要及时运输到，以免影响流水线的生产。而流水线终点的产物并不需要一产生便运走，而是要求在缓冲区满后必须运走，避免影响后续产品的存放。
    * 设计的调度需求需要根据静态的任务表生成一天的车辆调度计划，要求满足各个运输任务，并且能处理少量的动态生成的任务。
***
### Assumption
* ##### Map & Assembles
    ```java
        //about map
        public final static int MAXX_NUM = 10;
        public final static int LONG = 2000;
        public final static int WIDTH = 500;
        
        //about trailer
        public final static int TRAILER_LIMIT = 4;
        
        //about task
        public final static int MAXX_STATIC_TASK_NUM = 100;
        public final static int MAXX_DYNAMIC_TASK_NUM = 10;
        public final static int WORK_START_TIME = 60;
        public final static int WORK_END_TIME = 24*60;
        public final static int TASK_MAXX_TIME = 23*60;
        public final static int TASK_MINN_TIME = 10;
        
        //about vehicle
        public final static int VEHICLE_NUM = 10;
        public final static int MAXX_SPEED = 250;
    ```
* ##### Task
* ##### Vehicle
***
### Solution
* ##### StrategyA
***
### TODO
* Add Timer (Finished!)
* unfinished task(Finished!)
* cost function
* vehicle speed（Finished!）
* 增大任务的密度，尽量使大部分车满负荷
* 增加衡量车辆负荷情况的指标
* 看api（订单的接口、对车的控制、地图接口）
* 行驶时间取上限（Finished!）

*** 
### ISSUE




***
### Test
* about Tasks

    * 
        |num|<2000|<=2500|<=3000|<=3500|<=4000|<=4500|<=5000|<=5500|<=6000|<=6500|<=7000|<=7500|<=8000|<=8500|<=9000|<=9500|<=10000|<=10500|<=11000|<=11500|<=12000|<=12500|<=13000|<=13500|<=14000|<=14500|<=15000|<=15500|<=16000|<=16500|<=17000|<=17500|<=18000|<=18500|
        |:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
        |assembles = 30|
        |frequency|0|1|24|560|4313|16303|29845|29578|14911|3880|545|40|0|
        |percent|0|0.00001|0.00024|0.0056|0.04313|0.16303|0.29845|0.29578|0.14911|0.0388|0.00545|0.0004|0|
        |assembles = 35|
        |frequency|0|0|0|0|10|130|1045|4960|13378|23203|26132|18920|8847|2777|532|58|7|1|
        |percent|0|0|0|0|0.0001|0.0013|0.01045|0.0496|0.13378|0.23203|0.26132|0.1892|0.08847|0.02777|0.00532|0.00058|0.00007|0.00001|
        |assembles = 40|
        |frequency|0|0|0|0|0|1|2|15|161|888|3113|8223|15549|21205|21241|15972|8743|	3549|1038|259|36|5|
        |percent|0|0|0|0|0|0.00001|0.00002|0.00015|0.00161|0.00888|0.03113|0.08223|0.15549|0.21205|0.21241|0.15972|0.08743|0.03549|0.01038|0.00259|0.00036|0.00005|
        |assembles = 45|
        |frequency|0|	0|	0|	0|	0	|0|	0	|0|	1|	2|	14|	93|	392|	1361|	3781|	8063|	12972|	17597|	18738|	15913|	11004|	6116|	2644|	936|	305|	54|	12|	2|
        |percent|0|	0|	0|	0|	0|	0|	0|	0	|0.00001	|0.00002|	0.00014	|0.00093|	0.00392|	0.01361	|0.03781	|0.08063	|0.12972|	0.17597	|0.18738	|0.15913|	0.11004|	0.06116	|0.02644	|0.00936	|0.00305|	0.00054|	0.00012	|0.00002|
        |assembles = 50|
        |frequency|0	|0|	0	|0|	0|	0|	0|	0|	0|	0	|0	|1|	2|	7|	38|	128	|446	|1286|	2944|	5884|	9917|	13417	|15860	|15801|	13445	|9733|	5943|	3052|	1389|	528|	133|	29|	15|	2|
        |percent|0	|0	|0|	0	|0|	0	|0|	0|	0|	0|	0|	0.00001|	0.00002	|0.00007|	0.00038|	0.00128|	0.00446|	0.01286|	0.02944	|0.05884|	0.09917	|0.13417|	0.1586|	0.15801|	0.13445	|0.09733|	0.05943	|0.03052	|0.01389|0.00528|	0.00133|	0.00029|	0.00015	|0.00002|
    
    * ![image text](https://gitlab.uisee.ai/compass/incubations/vrp/blob/master/test/Distribution%20of%20num-of-tasks%20versus%20num-of-assembles.png)
    * ![image text](https://gitlab.uisee.ai/compass/incubations/vrp/blob/master/test/Distribution%20of%20num-of-tasks%20versus%20num-of-assembles(smooth).png)

* About WorkLoad
    * Without Dynamic Tasks
        1. 在当前任务密度下，原定的20~30辆车远不能完成当前的任务。假设以10%作为阈值，如果想达到至多不超过10%的任务超时完成，那么在有30条流水线的情况下，需要40辆车。当流水线的数目增加时，所需的车辆数量会快速增长。
        2. 此外，可以发现的是，当增大车辆数时，车辆的完成时间明显提前，可是仍有可能存在超时任务。这个原因在于任务并不是均匀分布在每一个时间段的，极有可能在某一个时间段任务量极大，导致了那个时间段内有一定数量的超时任务。故，研究任务在各个时间段内的分布情况也是很有意义的。
        
        |num of cases|num of assembles|num of vehicles|percent of unfinished tasks|average finish time|
        |:---:|:---:|:---:|:---:|:---:|
        |100|25|20|22%|1438.26|
        |100|25|25|12.9%|1438.46|
        |100|25|30|6.3%|1433.69|
        |100|25|35|0.7%|1399.86|
        |100|25|40|0.007%|1309.11|
        |100|25|45|0.003%|1212.93|
        |100|25|50|0%|1092.13|
        |100|25|55|0%|1032.88|
        |100|25|60|0%|947.34|
        |100|25|65|0%|879.53|
        |100|25|70|0%|830.43|
        |
        |100|30|20|38%|1438.22|
        |100|30|25|27%|1438.21|
        |100|30|30|17%|1438.32|
        |100|30|35|12%|1437.91|
        |100|30|40|7%|1431.02|
        |100|30|45|3%|1416.34|
        |100|30|50|2%|1363.19|
        |100|30|55|0.5%|1293.87|
        |100|30|60|0.08%|1212.61|
        |100|30|65|0.002%|1128.67|
        |
        |100|35|20|49%|1438.26|
        |100|35|25|40%|1438.2|   
        |100|35|30|31%|1438.25|
        |100|35|35|24%|1438.28|
        |100|35|40|18%|1438.34|
        |100|35|45|12%|1438.44|
        |100|35|50|7%|1436.46|
        |100|35|55|5%|1430.3|
        |100|35|60|3%|1425.35|
        |100|35|65|1%|1376.9|
        |
        |100|40|20|59%|1438.41|
        |100|40|25|51%|1438.3|   
        |100|40|30|43%|1438.18|
        |100|40|35|37%|1438.22|
        |100|40|40|29%|1438.31|
        |100|40|45|23%|1438.29|
        |100|40|50|18%|1438.43|
        |100|40|55|13%|1438.54|
        |100|40|60|9%|1438.25|
        |100|40|65|7%|1437.35|
        |
        |100|45|20|66%|1438.46|
        |100|45|25|58%|1438.42|   
        |100|45|30|52%|1438.38|
        |100|45|35|46%|1438.24|
        |100|45|40|39%|1438.25|
        |100|45|45|35%|1438.27|
        |100|45|50|29%|1438.33|
        |100|45|55|25%|1438.41|
        |100|45|60|20%|1438.47|
        |100|45|65|16%|1438.37|
        |
        |100|50|20|71%|1438.6|
        |100|50|25|65%|1438.5|   
        |100|50|30|59%|1438.53|
        |100|50|35|54%|1438.44|
        |100|50|40|49%|1438.44|
        |100|50|45|43%|1438.4|
        |100|50|50|38%|1438.24|
        |100|50|55|34%|1438.2|
        |100|50|60|31%|1438.33|
        |100|50|65|25%|1438.37|
        |100|50|70|22%|1438.38|
        |100|50|75|18%|1438.45|



    





























### Test(ABOLISHED)
|num of cases|num of assembles|num of vehicles|num of task|time cycle of task|percentages of time-exceeding tasks|average time|max time|
|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
|100|<5|5|<30|240min|0%|<1s|<1s|
|10000|<5|5|<30|240min|0%|<1s|<1s|
|1000000|<5|5|<30|240min|0%|<1s|<1s|
|-|-|-|-|-|-|-|-|
|100|<10|5|-|240min|0%|<1s|1.7s|
|30|<10|5|<600|120min|0%|7.6s|7.9s|
|<font color="red">Test Again!|<10|5|<600|90min|0%|7.5s|29s|
|30|<10|5|<800|Mixed|0%|14.8s|<font color="green">>1min|
|10000|<10|10|<800|Mixed|0%|8.6s|<font color="green">>5min|
|100|<15|10|<1200|Mixed|0%|54.8s|<font color="green">>15min|
|100|<20|10|<2500|Mixed|0%|too large|<font color="green">>too large|
|10|=20|20|<2500|Mixed|0%|too large|<font color="green">>too large|


### Test2
Try to simplify the algorithm.
Add task to the end of arrangment with comparing the length of driving.
|num of cases|num of assembles|num of vehicles|num of task|time cycle of task|percentages of time-exceeding tasks|average time|max time|
|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|


### Test3
Add solutions to arrage time-exceeding tasks
|num of cases|num of assembles|num of vehicles|num of task|time cycle of task|percentages of time-exceeding tasks|average exceeding time|average time|max time|
|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|


### Test4
About dealing with dynamic Test

